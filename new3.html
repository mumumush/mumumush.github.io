<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>è½åŠ›å¥åº·å¿ƒç†æ¸¬é©—</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", sans-serif;
      background: linear-gradient(135deg, #ffcce6, #ccf2ff, #e6ffcc, #ffcccc);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .container {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      width: 90%;
      max-width: 600px;
      margin: 20px auto;
      position: relative;
    }
    h1, h2, h3 {
      text-align: left;
      color: #333;
      margin-bottom: 12px;
      font-weight: bold;
    }
    .question {
      margin: 20px 0;
    }
    .options {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 10px 0;
    }
    .option {
      background: #fff;
      border: 2px solid #6bcb77;
      border-radius: 10px;
      padding: 10px 15px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .option:hover {
      background: #6bcb77;
      color: #fff;
    }
    .option.selected {
      background: #6bcb77;
      color: #fff;
    }
    .slider-container {
      width: 100%;
      margin: 20px 0;
    }
    .slider {
      width: 100%;
    }
    .slider-value {
      text-align: center;
      font-size: 18px;
      margin: 10px 0;
    }
    .btn {
      background: #b39ddb;
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      margin: 10px 5px;
      transition: all 0.2s;
    }
    .btn:hover {
      background: #9575cd;
    }
    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .result-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 1fr 1fr;
      gap: 15px;
      margin-bottom: 20px;
    }
    .result-item {
      background: #fff;
      border-radius: 15px;
      padding: 15px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      text-align: left;
    }
    .result-img {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      margin-bottom: 0;
      min-height: 150px;
    }
    .result-img img {
      width: 150px;
      height: 150px;
      display: block;
      margin: 0 auto;
    }
    .result-img-label {
      font-weight: bold;
      font-size: 20px;
      margin-top: 12px;
      text-align: center;
      letter-spacing: 1px;
    }
    .result-footer {
      width: 100%;
      background: #f6f6f6;
      border-radius: 15px;
      padding: 15px;
      margin-top: 20px;
      text-align: left;
      position: relative;
      box-sizing: border-box;
    }
    .result-footer-hr {
      width: 100%;
      margin: 30px 0 10px 0;
      border: 0;
      border-top: 2px solid #eee;
      box-sizing: border-box;
    }
    .result-section-title {
      display: flex;
      align-items: center;
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 8px;
    }
    .result-section-title span.emoji {
      margin-left: 6px;
      font-size: 20px;
    }
    ul.bullet-list {
      list-style-type: circle;
      padding-left: 20px;
      margin: 0 0 8px 0;
      text-align: left;
    }
    @media (max-width: 500px) {
      .container {
        width: 95%;
        padding: 15px;
      }
      .result-img img {
        width: 110px;
        height: 110px;
      }
      .result-img {
        min-height: 110px;
      }
      .result-img-label {
        font-size: 16px;
      }
    }
    .cave-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      opacity: 0.3;
      background: radial-gradient(circle, #ffcce6, #ccf2ff, #e6ffcc, #ffcccc);
      background-size: cover;
      background-position: center;
      transition: background-image 0.5s;
    }
    .cave-bg.start {
      background-image: url("img/start_bg.jpg");
    }
    .cave-bg.tinnitus {
      background-image: url("img/tinnitus_bg.jpg");
    }
    .cave-bg.sleep {
      background-image: url("img/sleep_bg.jpg");
    }
    .cave-bg.dizzy {
      background-image: url("img/dizzy_bg.jpg");
    }
  </style>
</head>
<body>
  <div class="cave-bg start"></div>
  <div class="container">
    <div id="content"><!-- å…§å®¹æœƒå‹•æ…‹è¼‰å…¥ --></div>
  </div>
  <script>
    // é¡Œç›®è³‡æ–™
    const questions = [
      {
        // 0: å§“åå¹´é½¡
        type: "start",
        title: "æ­¡è¿ä¾†åˆ°è½åŠ›å¥åº·å¿ƒç†æ¸¬é©—",
        inputs: [
          { id: "name", label: "æ‚¨çš„å§“å", type: "text", required: true },
          { id: "age", label: "æ‚¨çš„å¹´é½¡", type: "number", required: true },
        ],
      },
      {
        // 1: è€³é³´1
        type: "radio",
        id: "tinnitus1",
        title: "è«‹å•ä½ æœ‰è€³é³´å—ï¼ˆè€³æœµè£¡é¢æœƒå˜°å˜°å«æˆ–è½Ÿè½Ÿå«ï¼‰ï¼Ÿ",
        options: [
          { label: "æœ‰", value: "yes" },
          { label: "æ²’æœ‰", value: "no" },
        ],
      },
      {
        // 2: è€³é³´2
        type: "radio",
        id: "tinnitus2",
        title: "è€³é³´çš„é »ç‡ï¼Ÿ",
        options: [
          { label: "æ¯å¤©", value: "daily" },
          { label: "ä¸€é€±è¶…éä¸€æ¬¡", value: "weekly" },
          { label: "å¶çˆ¾ï¼ˆå°æ–¼ä¸€é€±ä¸€æ¬¡ï¼‰", value: "rarely" },
        ],
      },
      {
        // 3: è€³é³´3
        type: "radio",
        id: "tinnitus3",
        title: "è€³é³´çš„è²éŸ³ç¨®é¡æ¯”è¼ƒåƒä»€éº¼ï¼Ÿ",
        options: [
          { label: "é«˜é »ï¼ˆèŸ¬å«ã€å˜°å˜°å«ï¼‰", value: "high" },
          { label: "ä½é »ï¼ˆè½Ÿè½Ÿå«ï¼‰", value: "low" },
          { label: "éƒ½ä¸åƒ", value: "none" },
        ],
      },
      {
        // 4: ç¡çœ 1
        type: "checkbox",
        id: "sleep1",
        title: "è«‹å•ä½ æœ‰ä»¥ä¸‹çš„ç¡çœ å›°æ“¾å—ï¼Ÿ(å¯è¤‡é¸)",
        options: [
          { label: "é›£ä»¥å…¥ç¡", value: "hard_to_sleep" },
          { label: "å®¹æ˜“é†’ä¾†", value: "wake_up" },
          { label: "å¤šå¤¢", value: "dreams" },
          { label: "ä»¥ä¸Šéƒ½æ²’æœ‰", value: "none" },
        ],
      },
      {
        // 5: ç¡çœ 2
        type: "slider",
        id: "sleep2",
        title: "æ¯å¤©å¹³å‡ç¡å¹¾å€‹å°æ™‚ï¼Ÿ",
        min: 2,
        max: 15,
        step: 1,
      },
      {
        // 6: çœ©æšˆ
        type: "checkbox",
        id: "dizzy1",
        title: "è«‹å•ä½ æœƒæœ‰ä¸‹é¢çš„å›°æ“¾å—ï¼Ÿ(å¯è¤‡é¸)",
        options: [
          { label: "çœ©æšˆ", value: "dizzy" },
          { label: "è…³æ­¥ä¸ç©©", value: "unstable" },
          { label: "è·Œå€’", value: "fall" },
          { label: "éƒ½æ²’æœ‰", value: "none" },
        ],
      },
    ];

    // å¹´é½¡å°æ‡‰å»ºè­°ç¡çœ æ™‚æ•¸
    function getSleepNorm(ageNum) {
      if (ageNum < 1) return 12;
      if (ageNum < 3) return 11;
      if (ageNum < 6) return 10;
      if (ageNum < 13) return 9;
      if (ageNum < 19) return 8;
      return 7;
    }

    // ä½¿ç”¨è€…è³‡æ–™
    let user = {};
    let answers = {};
    let currentStep = 0;

    function setBg() {
      const bg = document.querySelector(".cave-bg");
      bg.className = "cave-bg"; // å…ˆç§»é™¤
      if (currentStep === 0) bg.classList.add("start");
      else if (currentStep >= 1 && currentStep <= 3)
        bg.classList.add("tinnitus");
      else if (currentStep >= 4 && currentStep <= 5)
        bg.classList.add("sleep");
      else if (currentStep === 6) bg.classList.add("dizzy");
    }

    // ä¸»æ¸²æŸ“
    function render() {
      const content = document.getElementById("content");
      setBg();

      if (currentStep === 0) {
        // é–‹å§‹é 
        const q = questions[0];
        content.innerHTML = `
          <h2 style="text-align:center;">${q.title}</h2>
          <div class="question">
            ${q.inputs
              .map(
                (input) => `
              <div style="margin: 15px 0;">
                <label style="display:block; margin-bottom:5px;">${input.label}</label>
                <input type="${input.type}" id="${input.id}" style="width:100%; padding:8px; border-radius:8px; border:1px solid #ccc;" required>
              </div>
            `
              )
              .join("")}
          </div>
          <div style="text-align:center; margin-top:20px;">
            <button class="btn" style="background:#b39ddb;" onclick="startQuiz()">é–‹å§‹æ¸¬é©—</button>
          </div>
        `;
      } else if (currentStep < questions.length) {
        // é¡Œç›®é 
        const q = questions[currentStep];
        let optionsHtml = "";
        if (q.type === "radio") {
          optionsHtml = q.options
            .map(
              (opt) => `
              <div class="option" onclick="selectOption(${currentStep}, '${opt.value}')" id="opt_${currentStep}_${opt.value}">
                ${opt.label}
              </div>
            `
            )
            .join("");
        } else if (q.type === "checkbox") {
          optionsHtml = q.options
            .map(
              (opt) => `
              <div class="option" onclick="toggleCheckbox(${currentStep}, '${opt.value}')" id="opt_${currentStep}_${opt.value}">
                ${opt.label}
              </div>
            `
            )
            .join("");
        } else if (q.type === "slider") {
          optionsHtml = `
            <div class="slider-container">
              <input type="range" class="slider" id="slider_${currentStep}" min="${q.min}" max="${q.max}" value="${q.min}" step="${q.step}" oninput="updateSlider(${currentStep})">
              <div class="slider-value" id="slider_value_${currentStep}">${q.min} å°æ™‚</div>
            </div>
          `;
        }
        content.innerHTML = `
          <h3 style="text-align:left;">${q.title}</h3>
          <div class="options">${optionsHtml}</div>
          <div style="text-align:center; margin-top:20px;">
            ${currentStep > 1 ? `<button class="btn" onclick="prevStep()">ä¸Šä¸€é¡Œ</button>` : ""}
            <button class="btn" onclick="nextStep()" id="nextBtn" disabled>ä¸‹ä¸€é¡Œ</button>
          </div>
        `;
        // é è¨­é¸é …
        if (answers[q.id]) {
          if (q.type === "radio") {
            const radioOption = document.getElementById(
              `opt_${currentStep}_${answers[q.id]}`
            );
            if (radioOption) {
              radioOption.classList.add("selected");
            }
            document.getElementById("nextBtn").disabled = false;
          } else if (q.type === "checkbox") {
            answers[q.id].forEach((val) => {
              const checkboxOption = document.getElementById(
                `opt_${currentStep}_${val}`
              );
              if (checkboxOption) {
                checkboxOption.classList.add("selected");
              }
            });
            document.getElementById("nextBtn").disabled = false;
          } else if (q.type === "slider") {
            const slider = document.getElementById(`slider_${currentStep}`);
            const sliderValueDisplay = document.getElementById(
              `slider_value_${currentStep}`
            );
            if (slider && sliderValueDisplay) {
              slider.value = answers[q.id];
              sliderValueDisplay.textContent = answers[q.id] + " å°æ™‚";
            }
            document.getElementById("nextBtn").disabled = false;
          }
        }
      } else {
        // çµæœé 
        const hasTinnitus = answers.tinnitus1 === "yes";
        const hasSleepProblem =
          answers.sleep1 && answers.sleep1.some((v) => v !== "none");
        const hasDizzy =
          answers.dizzy1 && answers.dizzy1.some((v) => v !== "none");
        // å¹´é½¡èˆ‡å»ºè­°ç¡çœ æ™‚æ•¸
        const ageNum = parseInt(user.age, 10);
        const sleepNorm = getSleepNorm(ageNum);
        const sleepHours = parseInt(answers.sleep2 || 0, 10);
        // ç¡çœ ä¸åˆæ ¼æ¢ä»¶ï¼ˆä¿®æ­£ç‚ºåªæœ‰ç¡çœ æ™‚æ•¸ä¸è¶³æ‰ç®—ä¸åˆæ ¼ï¼‰
        const sleepNotEnough = sleepHours < sleepNorm;
        // è§’è‰²åœ–ç´¢å¼•
        const imgIndex =
          (hasTinnitus ? 4 : 0) +
          (sleepNotEnough || hasSleepProblem ? 2 : 0) +
          (hasDizzy ? 1 : 0);
        // å¥åº·å¤¥ä¼´åœ–
        let charImg = `<img src="img/monster_${imgIndex}.jpg" alt="å¥åº·å°å¤¥ä¼´">`;

        // è€³é³´çµè«–
        let tinnitusResult = "";
        if (!hasTinnitus) {
          tinnitusResult = `
            <ul class="bullet-list">
              <li>æ­å–œæ‚¨ç›®å‰ä¸¦æ²’æœ‰è€³é³´çš„å›°æ“¾</li>
              <li>å»ºè­°æ¯å¹´è¿½è¹¤ä¸€æ¬¡è½åŠ›ï¼Œä»¥ç¢ºä¿æ‚¨çš„è½åŠ›ç‹€æ³</li>
              <li>
                <a href="https://www.greattree.com.tw/stores/a2267fEF473Ecb7C" target="_blank">é ç´„å…è²»è½åŠ›æª¢æŸ¥</a>
              </li>
            </ul>
          `;
        } else {
          tinnitusResult = `
            <ul class="bullet-list">
              <li>æ ¹æ“š<a href="https://wd.vghtpe.gov.tw/ent/Fpage.action?fid=4343" target="_blank">å°åŒ—æ¦®ç¸½è€³é¼»å–‰ç§‘</a>ï¼Œè€³é³´å€‹æ¡ˆä¸­ç´„æœ‰90%æœ‰è½åŠ›å—æï¼Œå»ºè­°è‡³è½åŠ›ä¸­å¿ƒè©³ç´°æª¢æŸ¥</li>
              ${
                answers.tinnitus2 === "daily" || answers.tinnitus2 === "weekly"
                  ? answers.tinnitus3 === "high"
                    ? `<li>æ‚¨ç›®å‰æœ‰æ˜é¡¯çš„é«˜é »è€³é³´è²ï¼Œå¯èƒ½æœƒæœ‰é«˜é »è½åŠ›æå¤±çš„é¢¨éšª</li>`
                    : answers.tinnitus3 === "low"
                    ? `<li>æ‚¨ç›®å‰æœ‰æ˜é¡¯çš„ä½é »è€³é³´è²ï¼Œå¯èƒ½æœƒæœ‰ä½é »è½åŠ›æå¤±çš„é¢¨éšª</li>`
                    : ""
                  : ""
              }
              <li>
                <a href="https://www.greattree.com.tw/stores/a2267fEF473Ecb7C" target="_blank">é ç´„å…è²»è½åŠ›æª¢æŸ¥</a>
              </li>
            </ul>
          `;
        }

        // ç¡çœ çµè«–ï¼ˆä¿®æ­£é‚è¼¯ï¼‰
        let sleepResult = "";
        if (sleepNotEnough) {
          sleepResult = `
            <ul class="bullet-list">
              <li>ä½ çš„ç¡çœ æ™‚æ•¸ä½æ–¼
                <a href="https://www.facebook.com/InterviewMap/posts/%E7%BE%8E%E5%9C%8B%E7%9D%A1%E7%9C%A0%E9%86%AB%E5%AD%B8%E6%9C%83aasm%E5%BB%BA%E8%AD%B0%E6%AF%8F%E5%80%8B%E5%B9%B4%E9%BD%A1%E5%B1%A4%E7%9A%84%E5%81%A5%E5%BA%B7%E7%9D%A1%E7%9C%A0%E6%99%82%E9%96%93/2871842113070905/?locale=zh_TW" target="_blank">ç¾åœ‹ç¡çœ é†«å­¸æœƒ</a>å»ºè­°
              </li>
              <li>å»ºè­°æ”¹å–„ç¡çœ å“è³ªï¼Œå¿…è¦æ™‚è«‹è«®è©¢å°ˆæ¥­é†«å¸«ã€‚</li>
              <li>
                äº¦å¯åƒè€ƒ
                <a href="https://shop.greattree.com.tw/productlist?item1=02&item2=0297&item3=029714" target="_blank">ç¡çœ ä¿å¥é£Ÿå“</a>ä»¥æå‡ç¡çœ å“è³ª(æœç”¨å‰è«‹è©¢å•å°ˆæ¥­è—¥å¸«)
              </li>
            </ul>
          `;
        } else if (hasSleepProblem) {
          sleepResult = `
            <ul class="bullet-list">
              <li>ä½ é›–ç„¶ç¡çœ æ™‚æ•¸è¶³å¤ ï¼Œä½†æœ‰ç¡çœ å›°æ“¾ï¼ˆå¦‚å¤šå¤¢ã€é›£ä»¥å…¥ç¡ç­‰ï¼‰ï¼Œå¯èƒ½å½±éŸ¿ç¡çœ å“è³ª</li>
              <li>å»ºè­°å°‹æ±‚é†«ç”Ÿå”åŠ©ï¼Œæˆ–æœç”¨
                <a href="https://shop.greattree.com.tw/productlist?item1=02&item2=0297&item3=029714" target="_blank">ç¡çœ ä¿å¥é£Ÿå“</a>ä»¥æå‡ç¡çœ å“è³ª(æœç”¨å‰è«‹è©¢å•å°ˆæ¥­è—¥å¸«)
              </li>
            </ul>
          `;
        } else {
          sleepResult = `
            <ul class="bullet-list">
              <li>æ‚¨ç›®å‰ç¡çœ ç‹€æ³è‰¯å¥½ï¼Œç¥ç¦æ‚¨æœ‰ç¾å¥½çš„ç¡çœ ä»¥åŠè‰¯å¥½çš„ç”Ÿæ´»å“è³ªï¼</li>
            </ul>
          `;
        }

        // çœ©æšˆçµè«–
        let dizzyResult = "";
        if (hasDizzy) {
          dizzyResult = `
            <ul class="bullet-list">
              <li>æ ¹æ“šè¡›ç”Ÿç½²çš„çµ±è¨ˆï¼Œã€Œè·Œå€’ã€æ˜¯65æ­²ä»¥ä¸Šè€å¹´äººäº‹æ•…å‚·å®³æ­»äº¡çš„ç¬¬äºŒå¤§åŸå› ã€‚è·Œå€’å¯èƒ½å°è‡´é«–éƒ¨éª¨æŠ˜ã€é ­éƒ¨å¤–å‚·ã€ç¡¬è…¦è†œä¸‹å‡ºè¡€ã€è»Ÿçµ„ç¹”æå‚·ã€‚å› æ­¤ï¼Œé é˜²è·Œå€’å°æ–¼è€å¹´äººä¾†èªªè‡³é—œé‡è¦ã€‚</li>
              <li>çœ©æšˆæ˜¯æŒ‡æœ‰å¤©æ—‹åœ°è½‰æˆ–æ–æ™ƒæ„Ÿï¼Œæ˜¯èº«é«”å¹³è¡¡ç³»çµ±å¤±èª¿çš„è¡¨ç¾ã€‚ ä¸»è¦æˆå› æœ‰:å…§è€³å•é¡Œã€ä¸­æ¨ç¥ç¶“ç³»çµ±ç—…è®Šã€æˆ–å…¨èº«æ€§ç–¾ç—…ç­‰ï¼›å»ºè­°å°±é†«è«‹é†«å¸«è©•ä¼°æ˜¯å¦æœ‰éœ€é€²ä¸€æ­¥æ²»ç™‚ã€‚</li>
              <li>äº¦å¯åœ¨é†«å¸«çš„è©•ä¼°ä¸‹é€²è¡Œ
                <a href="https://www.uho.com.tw/article-61248.html" target="_blank">å‰åº­å¾©å¥</a>
              </li>
            </ul>
          `;
        } else {
          dizzyResult = `
            <ul class="bullet-list">
              <li>æ²’æœ‰æ˜é¡¯çœ©æšˆå•é¡Œï¼Œè«‹æŒçºŒæ³¨æ„èº«é«”ç‹€æ³</li>
            </ul>
          `;
        }

        // çµæœé 
        content.innerHTML = `
          <h2 style="text-align:center;">${user.name} çš„æ¸¬é©—çµæœ</h2>
          <div class="result-grid">
            <div class="result-item" style="display:flex;flex-direction:column;align-items:center;justify-content:flex-start;">
              <div class="result-img">
                ${charImg}
              </div>
              <div class="result-img-label result-section-title" style="margin-top:12px;">ä½ çš„å¥åº·å°å¤¥ä¼´</div>
            </div>
            <div class="result-item">
              <div class="result-section-title">è€³é³´<span class="emoji">ğŸ‘‚</span></div>
              ${tinnitusResult}
            </div>
            <div class="result-item">
              <div class="result-section-title">ç¡çœ <span class="emoji">ğŸ’¤</span></div>
              ${sleepResult}
              <div style="color:#4D96FF;font-weight:bold;margin-top:6px;">
                ä½ çš„å¹´é½¡å»ºè­°æ¯å¤©ç¡çœ æ™‚æ•¸ï¼š${sleepNorm} å°æ™‚
              </div>
            </div>
            <div class="result-item">
              <div class="result-section-title">çœ©æšˆ<span class="emoji">ğŸŒ€</span></div>
              ${dizzyResult}
            </div>
          </div>
          <hr class="result-footer-hr">
          <div class="result-footer">
            æœ¬æ¸¬é©—æ˜¯ç”± <b>å¤å¯Œç¶¿è½åŠ›å¸«</b> è¦ªè‡ªè£½ä½œï¼Œç‚ºäº†å¹«åŠ©ä½¿ç”¨è€…æé«˜å°æ–¼è€³é³´ã€ç¡çœ ä»¥åŠçœ©æšˆçš„è‡ªæˆ‘èªçŸ¥ï¼Œä¸¦æä¾›ç›¸é—œå»ºè­°ã€‚è¬è¬æ‚¨çš„ä½¿ç”¨èˆ‡é—œæ³¨ï¼Œæœ‰ä»»ä½•å•é¡Œä¹Ÿæ­¡è¿å¯„ä¿¡çµ¦1998mushroom@gmail.comèˆ‡æˆ‘äº¤æµå…±åŒæˆé•·ã€‚
          </div>
          <div style="text-align:center;margin-top:20px;">
            <button class="btn" style="background:#b39ddb;" onclick="restartQuiz()">å†æ¸¬ä¸€æ¬¡</button>
          </div>
        `;
      }
    }

    // é–‹å§‹æ¸¬é©—
    function startQuiz() {
      const name = document.getElementById("name").value;
      const age = document.getElementById("age").value;
      if (!name || !age) {
        alert("è«‹è¼¸å…¥å§“åèˆ‡å¹´é½¡");
        return;
      }
      user = { name, age };
      currentStep = 1;
      render();
    }

    function selectOption(step, value) {
      const q = questions[step];
      answers[q.id] = value;

      // æ¸…é™¤å…¶ä»–é¸é …
      document.querySelectorAll(`.option[id^="opt_${step}_"]`).forEach((el) => {
        el.classList.remove("selected");
      });

      // æ–°å¢é¸æ“‡çš„é¸é …
      const selectedOption = document.getElementById(`opt_${step}_${value}`);
      if (selectedOption) {
        selectedOption.classList.add("selected");
      }

      // å•Ÿç”¨ä¸‹ä¸€æ­¥æŒ‰éˆ•
      const nextBtn = document.getElementById("nextBtn");
      if (nextBtn) {
        nextBtn.disabled = false;
      }

      // å¦‚æœè€³é³´é¸é …æ˜¯ 'no'ï¼Œè·³éä¸­é–“æ­¥é©Ÿ
      if (q.id === "tinnitus1" && value === "no") {
        currentStep = 4; // è·³éè€³é³´2,3
        setTimeout(render, 300);
      }
    }

    // è¤‡é¸äº’æ–¥é‚è¼¯
    function toggleCheckbox(step, value) {
      const q = questions[step];
      if (!answers[q.id]) answers[q.id] = [];

      // äº’æ–¥é‚è¼¯
      if (value === "none") {
        // é¸ã€Œä»¥ä¸Šéƒ½æ²’æœ‰ã€æ™‚ï¼Œæ¸…ç©ºå…¶ä»–é¸é …ï¼Œåªç•™ none
        answers[q.id] = ["none"];
        // ç§»é™¤å…¶ä»–é¸é …çš„é¸ä¸­æ¨£å¼
        q.options.forEach((opt) => {
          const el = document.getElementById(`opt_${step}_${opt.value}`);
          if (el) el.classList.remove("selected");
        });
        document.getElementById(`opt_${step}_none`).classList.add("selected");
      } else {
        // é¸å…¶ä»–é¸é …æ™‚ï¼Œç§»é™¤ none
        answers[q.id] = answers[q.id].filter((v) => v !== "none");
        const idx = answers[q.id].indexOf(value);
        if (idx === -1) {
          answers[q.id].push(value);
        } else {
          answers[q.id].splice(idx, 1);
        }
        // å–æ¶ˆ none çš„é¸ä¸­æ¨£å¼
        const noneEl = document.getElementById(`opt_${step}_none`);
        if (noneEl) noneEl.classList.remove("selected");
      }

      // æ›´æ–°é¸ä¸­æ¨£å¼
      q.options.forEach((opt) => {
        const el = document.getElementById(`opt_${step}_${opt.value}`);
        if (el) {
          if (answers[q.id].includes(opt.value)) {
            el.classList.add("selected");
          } else {
            el.classList.remove("selected");
          }
        }
      });

      // å•Ÿç”¨ä¸‹ä¸€æ­¥æŒ‰éˆ•
      const nextBtn = document.getElementById("nextBtn");
      if (nextBtn) {
        nextBtn.disabled = !answers[q.id] || answers[q.id].length === 0;
      }
    }

    function updateSlider(step) {
      const q = questions[step];
      const sliderEl = document.getElementById(`slider_${step}`);
      const sliderValueEl = document.getElementById(`slider_value_${step}`);
      if (!sliderEl || !sliderValueEl) return;

      const value = sliderEl.value;
      answers[q.id] = value;
      sliderValueEl.textContent = value + " å°æ™‚";

      const nextBtn = document.getElementById("nextBtn");
      if (nextBtn) {
        nextBtn.disabled = false;
      }
    }

    // ä¸Šä¸€é¡Œ
    function prevStep() {
      if (currentStep > 1) {
        currentStep--;
        render();
      }
    }

    // ä¸‹ä¸€é¡Œ
    function nextStep() {
      const q = questions[currentStep];
      if (
        !answers[q.id] ||
        (Array.isArray(answers[q.id]) && answers[q.id].length === 0)
      ) {
        alert("è«‹é¸æ“‡ç­”æ¡ˆ");
        return;
      }
      if (currentStep < questions.length - 1) {
        currentStep++;
        render();
      } else {
        currentStep++;
        render();
      }
    }

    // é‡æ¸¬ä¸€æ¬¡
    function restartQuiz() {
      user = {};
      answers = {};
      currentStep = 0;
      render();
    }

    // åˆå§‹æ¸²æŸ“
    render();
  </script>
</body>
</html>
